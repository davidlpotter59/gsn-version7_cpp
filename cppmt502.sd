%%
Screen
        Name            = "cppmt502" ;
        Type            = "Detail" ;
        Padcharacter    = Space ;
        Highlite        = Underscore ;
        Screensize      = "dynamic" ;
        Windowtitle = "%a     %s Robbery and Safe Burglary (Form D) - Ver 7.00     %m" ;
        Domain          = "cppISOCRIME" ;
--      resizeable      = "yes" ;
        iconline        = 0;

        Global Unsigned Ascii Number G_policy_NO[9] ;
        Global Unsigned Ascii Number g_year[4] ;
        Global Unsigned Ascii Number g_end_sequence[4] ;
        Global Unsigned Ascii Number G_PREM_NO[4] ;
        Global Unsigned Ascii Number G_BUILD_NO[4] ;
        Global Unsigned Ascii Number G_SUB_CODE[4] ;

        Global String G_CRIME_FORM[1],
                      g_inquiry[1] ;

        Local Unsigned Ascii Number L_LIMIT[8] ,
                                    l_group[1],
                                    l_total_premium[6]=0/dec=0,
                                    L_Prem_TERR_FACTOR[5]=0/decimals=3,
                                    l_Mess_terr_factor[5]=0/decimals=3,
                                    l_safe_terr_factor[5]=0/decimals=3,
                                    l_line_of_business[4]=0008,
                                    L_INSIDE_MINIMUM[3]=0,
                                    L_INSIDE_EACH_ADDL[3]=0,
                                    l_safe_minimum[3]=0,
                                    l_safe_each_addl[3]=0,
                                    L_GUARD_CHARGE[2]=0,
                                    L_OUTSIDE_MINIMUM[3]=0,
                                    L_OUTSIDE_EACH_ADDL[3]=0 ,
                                    L_INSIDE_PER[5]=0,
                                    L_OUTSIDE_PER[5]=0,
                                    L_INSIDE_EACH_FACTOR[4]=0/decimals=2,
                                    L_OUTSIDE_EACH_FACTOR[4]=0/decimals=2,
                                    L_ARMORED_FACTOR[4]=0/decimals=2,
                                    L_PREMISES_CLOSED_FACTOR[4]=0/decimals=2 ,
                                    L_DEDUCTIBLE_FACTOR[4]=0/decimals=3 ,
                                    L_WATCHPERSON_FACTOR[4]=0/decimals=3,
                                    L_GUARDSERVICE_FACTOR[4]=0/decimals=3,
                                    L_ALARM_FACTOR[4]=0/decimals=3,
                                    L_SAFE_FACTOR[4]=0/decimals=3,
                                    l_factor1[6]=0/decimals=3,
                                    l_factor2[6]=0/decimals=3,
                                    l_safe_class_code[6]=0,
                                    l_robbery_code[6]=0,
                                    L_HOLDUP_FACTOR[4]=0/decimals=3,
                                    l_business_code_factor[4]=0/decimals=3,
                                    l_business_closed_premium[8]=0/decimals=3,
                                    l_business_closed_credit[8]=0/decimals=3,
                                    l_entire_plot_factor[4]=0/decimals=3,
                                    L_GASSYSTEMS_FACTOR[4]=0/decimals=3,
                                    L_BULLET_FACTOR[4]=0/decimals=3,
                                    L_CONVEYANCE_FACTOR[4]=0/decimals=3,
                                    l_multi_messenger_factor[6]=0/decimals=3 ,
                                    l_money_excess[8]=0,
                                    l_bond_excess_factor1[4]=0/decimals=3,
                                    l_bond_excess_factor2[4]=0/decimals=3,
                                    l_crime1_terr[3]=0,
                                    l_loss_cost[5]=0/decimals=3,
                                    l_rmf_factor[5]=0/decimals=3,
                                    l_mess[3]=0,
                                    l_sub[3],
                                    l_group_type[1]=0,
                                    l_multi_total_premium[8]=0/decimals=3 ;

        Local String L_DESC[50],
                     l_guard[1],
                     l_crime_type[1],
                     l_safe_class[1],
                     l_messenger[1],
                     l_misc_code[1],
                     l_coverage_code[1],
                     l_inside_minimum_yes[1]="N",
                     l_outside_minimum_yes[1]="N",
                     l_section[1],
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_ADD_ENDORSEMENT[1] ,
                     L_DELETE_ENDORSEMENT[1],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55] ,
                     L_SCREEN[8] ;

        Local Signed Ascii Number l_package[4]=0/dec=2,
                                  l_adjusted_rate1[8]=0/decimals=3,
                                  l_adjusted_rate2[8]=0/decimals=3,
                                  l_adjusted_rate3[8]=0/decimals=3,
                                  l_adjusted_rate4[8]=0/decimals=3,
                                  l_minimum_total1[8]=0,
                                  l_minimum_total2[8]=0,
                                  l_minimum_total3[8]=0,
                                  l_deviation[4]=0/dec=2;

        Local Unsigned Ascii Number L_SUB_CODE[4],
                                    L_STATE[2] ,
                                    l_premium[6]=0;


        Access cppISOCRIME,
           Set cppISOCRIME:policy_NO    = G_policy_NO ,
               cppisocrime:pol_year     = g_year,
               cppisocrime:end_sequence = g_end_sequence,
               cppISOCRIME:PREM_NO      = G_PREM_NO ,
               cppISOCRIME:BUILD_NO     = G_BUILD_NO ,
               cppISOCRIME:CRIME_FORM   = G_CRIME_FORM ;

        Include "STDKEYS7.INC"

style definition

        include "styles.inc"

Functions

        Include "STDFUNC7.INC"

menu definition

        include "stdmenu7.inc"

}

toolbar definition

        include "stdtoolbar7.inc"

}

screen entry
if g_inquiry = "Y" then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    end

Access Validation
If cppISOCRIME:policy_NO    <> G_policy_NO Or
   cppisocrime:pol_year     <> g_year or
   cppisocrime:end_sequence <> g_end_sequence or
   cppISOCRIME:PREM_NO      <> G_PREM_NO Or
   cppISOCRIME:BUILD_NO     <> G_BUILD_NO Or
   cppISOCRIME:CRIME_FORM   <> G_CRIME_FORM Then
    Error 1000 ;

screen at 1,1 to 20,80
properties
        {
        Layouttype = column
        }
{
panel
properties
        {
        Borderstyle     = raised
        Scrollbarpolicy = asneeded
        }
{
%%
                                                        _______________
*------------------------------------------------------------------------------*
| Policy No:   _________  ____  ____                                           |
| Location No: ____                                                            |
| Building No: ____                                                            |
| Crime Form:  _                                                               |
*------------------------------------------------------------------------------*
%%

components

Fields
        FUNCTION/noecho/showasguidetext ;
301     Begin
        If FUNCTION = "ADD" Then
            Begin
            cppISOCRIME:policy_NO = G_policy_NO
            cppisocrime:pol_year = g_Year
            cppisocrime:end_sequence = g_end_sequence
            cppISOCRIME:PREM_NO = G_PREM_NO
            cppISOCRIME:BUILD_NO = G_BUILD_NO
            cppISOCRIME:CRIME_FORM = G_CRIME_FORM
            cppISOCRIME:STATE = cppGENERAL:STATE
            cppISOCRIME:COUNTY = cppGENERAL:COUNTY
            cppISOCRIME:rate_group = cppgeneral:rate_group
            cppISOCRIME:rating_line_of_business = 0008
            cppISOCRIME:cpqcrime1_sub_code = g_sub_code
            l_line_of_business = cppISOCRIME:rating_line_of_business

            Access sfpMASTER, Set sfpMASTER:policy_NO = G_policy_NO,
                                  sfpmaster:pol_year = g_year,
                                  sfpmaster:end_sequence = g_end_sequence, Generic

            If sfpMASTER:policy_NO <> G_policy_NO or
               sfpmaster:pol_year <> g_year or
               sfpmaster:end_sequence <> g_end_sequence Then
                Add sfpMASTER
                    Begin
                    sfpMASTER:policy_NO = G_policy_NO
                    sfpmaster:pol_year = g_year
                    sfpmaster:end_sequence = g_end_sequence
                    End
            End
        End
        cppISOCRIME:policy_NO/displayonly ;
302     cppisocrime:pol_year/displayonly ;
303     cppisocrime:end_sequence/displayonly ;
401     cppISOCRIME:PREM_NO/displayonly ;
501     cppISOCRIME:BUILD_NO/displayonly ;
601     cppISOCRIME:CRIME_FORM/displayonly ;

} -- end of header

CardDialog GUI at 1,80
{
panel
properties
        {
        Scrollbarpolicy = asneeded
        Text            = "Deductible"
        }
{

%%
*------------------------------------------------------------------------------*
| Deductible:  _____     Rate Group: __                                        |
*------------------------------------------------------------------------------*
%%
Components

Fields

201     Begin
        If FUNCTION = "ADD" Then
            cppISOCRIME:DEDUCTIBLE = CPSCRIMEDEFAULTS:DEDUCTIBLE
        End
        cppISOCRIME:DEDUCTIBLE/default
--        If cppISOCRIME:DEDUCTIBLE <> CPSISOCRDED:DEDUCTIBLE Then
  --          Error 1207

        Activehelp CPSISOCRDED_ALIAS:DEDUCTIBLE ;
202     cppISOCRIME:RATE_GROUP/default ;

}

panel
properties
        {
        Scrollbarpolicy = asneeded
        Text            = "Robbery"
        }
{
%%
*---------------------------------------------------------------------------------------------------*
| Limit: __________         Plan:  __     Safe/Vault Class: _____                                   |
*---------------------------------------------------------------------------------------------------*
| Coverage Form: __                                                                                 |
*---------------------------------------------------------------------------------------------------*
| Coverage              Actual Exposure   Factor      Multiplier                                    |
*---------------------------------------------------------------------------------------------------*
| Basic:                   _________     _________     _________                                    |
| Add'l:                   _________     _________     _________                                    |
| Gross Premium:                                       _________                                    |
*---------------------------------------------------------------------------------------------------*
|  Gross       Total      Form       Terr       Net     Deductible    Adj                  Final    |
| Premium      Disc       Mult       Mult     Premium     Credit    Premium       RMF     Premium   |
*---------------------------------------------------------------------------------------------------*
| _________  _________  _________  _________  _________  _________  _________  _________  _________ |
|                                                     Balance to Meet Minimum:            _________ |
|                                                     Total Premium:                      _________ |
*---------------------------------------------------------------------------------------------------*

%%

components

Fields
201     cppISOCRIME:LIMIT[1]
        if cppISOCRIME:limit[1] > 0 then
            do GET_PER_AMOUNT ;
202     begin
        if function = "ADD" then
            cppisocrime:plan = 1
        end
        cppISOCRIME:plan/default
        If cppISOCRIME:plan <> 1 Then
            Error 1262

        Activehelp CPSisoCRplan_alias:plan,
                   CPSisocrplan_alias:DESC ;
203     Begin
        If FUNCTION one of  "ADD" Then
            cppISOCRIME:SAFE_CLASS = CPSCRIMEDEFAULTS:SAFE_CLASS
        End
        cppISOCRIME:SAFE_CLASS/default/uppercase
--        If cppISOCRIME:SAFE_CLASS <> CPSISOCRSAFES_alias:SAFE_CLASS Then
  --            Error 1262

        cppISOCRIME:SAFE_CLASS_SUB_CODE = CPSISOCRSAFES:SUB_CODE

        Activehelp CPSISOCRSAFES_ALIAS:SAFE_CLASS/width=2/heading="CLASS",
                   cpsisocrsafes_alias:safe_vault/width=2/heading="TYPE",
                   cpsisocrsafes_alias:doors/width=40,
                   CPSISOCRSAFES_ALIAS:walls/width=75,
                   cpsisocrsafes_alias:labels[1]/width=100,
                   if cpsisocrsafes_alias:labels[2] <> "" then
                      cpsisocrsafes_alias:labels[2]
                   else
                      null,
                   if cpsisocrsafes_alias:labels[3] <> "" then
                      cpsisocrsafes_alias:labels[3] ;
401     cppisocrime:holdup_alarms
        if cppisocrime:holdup_alarms <> 5 and
           cppisocrime:holdup_alarms <> 6 then
            error 1262

         activehelp cpsisocrrobhelp_alias:grouptype/width=2,
                    cpsisocrrobhelp_alias:desc/width=50 ;
801     cppISOCRIME:money_exposure[1] ;
802     begin
        if function one of "ADD", "CHANGE" then
            begin
            if cppisocrime:money_exposure[1] > 0 then
                begin
                l_crime_type = "R"
                l_safe_class = "Z"
                l_group = cppisocrime:rate_group
                Do GET_ROBBERY
                end
            if l_factor1 = 0 then
                L_FACTOR1 = 1

            cppISOCRIME:base_factor_inside[1] = l_factor1
            end
        end
        cppISOCRIME:base_factor_inside[1]/displayonly;
803     begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:crime_total[1] = (cppisocrime:base_factor_inside[1] * (cppISOCRIME:money_exposure[1] divide l_inside_per))
        end
        cppISOCRIME:crime_total[1]/displayonly ;
901     begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:excess_exposure[1] = cppISOCRIME:limit[1] - cppISOCRIME:money_exposure[1]
        end
        cppISOCRIME:excess_exposure[1]/default ;
902     begin
        if function one of "ADD", "CHANGE" then
            begin
            if cppisocrime:excess_exposure[1] <> 0 then
                cppisocrime:base_factor_inside[2] = cppisocrime:base_factor_inside[1]
            else
                cppisocrime:base_factor_inside[2] = 1.00
            end
        end
        cppisocrime:base_factor_inside[2]/displayonly ;
903     begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:crime_total[2] = (cppisocrime:base_factor_inside[2] * (cppISOCRIME:excess_exposure[1] divide l_inside_per))
        end
        cppISOCRIME:crime_total[2]/displayonly ;
1001    begin
        if function one of "ADD", "CHANGE" then
            begin
            cppISOCRIME:gross_premium[1] = (cppISOCRIME:crime_total[1] +
                                            cppISOCRIME:crime_total[2])
            if cppisocrime:gross_premium[1] > 0 then
                begin
                l_safe_class = "Z"
                l_crime_type = "R"
                l_group_type = cppisocrime:holdup_alarms
                Do GET_FORM_MULTI
                cppisocrime:base_factor_inside[4] = l_factor1
                end
            end
        end
        cppISOCRIME:gross_premium[1]/displayonly ;  --multiplier total
1501    begin
        if function one of "ADD", "CHANGE" then
            do get_totals
        end
        cppisocrime:gross_premium[1]/displayonly ;
1502    begin
            l_deviation = 1.00
        end
        l_deviation/displayonly ;
1503    cppisocrime:base_factor_inside[4]/displayonly ;
1504    cppisocrime:territory_factor/displayonly ;
1505    cppisocrime:net_premium[1]/displayonly ;
1506    cppisocrime:deductible_premium[1]/displayonly ;
1507    cppisocrime:adjusted_rate[1]/displayonly ;
1508    cppisocrime:rmf_total[1]/displayonly ;
1509    cppisocrime:total_premium[1]/displayonly ;
1601    cppisocrime:minimum_premium[1]/displayonly ;
1701    cppisocrime:final_premium[1]/displayonly ;

}

panel
properties
        {
        Scrollbarpolicy = asneeded
        Text            = "Safe Burglary"
        }
{
%%
*---------------------------------------------------------------------------------------------------*
| Coverage              Actual Exposure   Factor      Multiplier                                    |
*---------------------------------------------------------------------------------------------------*
| Basic:                   _________     _________     _________                                    |
| Add'l:                   _________     _________     _________                                    |
| Gross Premium:                                       _________                                    |
*---------------------------------------------------------------------------------------------------*
|  Gross       Total      Form       Terr       Net     Deductible    Adj                  Final    |
| Premium      Disc       Mult       Mult     Premium     Credit    Premium       RMF     Premium   |
*---------------------------------------------------------------------------------------------------*
| _________  _________  _________  _________  _________  _________  _________  _________  _________ |
|                                                     Balance to Meet Minimum:            _________ |
|                                                     Total Premium:                      _________ |
*---------------------------------------------------------------------------------------------------*

%%

components

fields
0401    cppISOCRIME:securities_exposure[1] ;
0402    begin
        if function one of "ADD", "CHANGE" then
            begin
            If cppISOCRIME:securities_exposure[1] > 0 Then
                begin
                l_crime_type = "S"
                l_safe_class = "A"
                l_group = cppisocrime:rate_group
                Do GET_ROBBERY
                end
            if l_factor1 = 0 then
                L_FACTOR1 = 1

            cppISOCRIME:base_factor_inside[3] = l_factor1
            end
        end
        cppISOCRIME:base_factor_inside[3]/displayonly ;
0403    begin
        if function one of "ADD", "CHANGE" then
            begin
            cppISOCRIME:crime_total[3] = (cppisocrime:base_factor_inside[3] * (cppISOCRIME:securities_exposure[1] divide l_inside_per))
            end
        end
        cppISOCRIME:crime_total[3]/displayonly ;
0501    begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:checks_exposure[1] = cppISOCRIME:limit[1] - cppISOCRIME:money_exposure[1] - cppISOCRIME:securities_exposure[1] -
                                             cppISOCRIME:checks_exposure[1] - cppISOCRIME:payroll_exposure[1] - cppISOCRIME:bank_exposure[1]
        end
        cppISOCRIME:checks_exposure[1]/default ;
0502    begin
        if function one of "ADD", "CHANGE" then
            begin
            if cppisocrime:checks_exposure[1] <> 0 then
                cppisocrime:base_factor_inside[3] = cppisocrime:base_factor_inside[1]
            else
                cppisocrime:base_factor_inside[3] = 1.00
            end
        end
        cppisocrime:base_factor_inside[3]/displayonly ;
0503    begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:crime_total[4] = (cppisocrime:base_factor_inside[3] * (cppISOCRIME:checks_exposure[1] divide l_inside_per))
        end
        cppISOCRIME:crime_total[4]/displayonly ;
0601    begin
        if function one of "ADD", "CHANGE" then
            begin
            cppISOCRIME:gross_premium[2] = (cppISOCRIME:crime_total[3] +
                                            cppISOCRIME:crime_total[4])
            if cppisocrime:gross_premium[2] > 0 then
                begin
                l_safe_class = cppisocrime:safe_class
                l_crime_type = "S"
                l_group_type = 5
                Do GET_FORM_MULTI
                cppisocrime:base_factor_inside[5] = l_factor1
                end
            end
        end
        cppISOCRIME:gross_premium[2]/displayonly ;  --multiplier total
1101    begin
        if function one of "ADD", "CHANGE" then
            do get_totals
        end
        cppisocrime:gross_premium[2]/displayonly ;
1102    begin
            l_deviation = 1.00
        end
        l_deviation/displayonly ;
1103    cppisocrime:base_factor_inside[5]/displayonly ;
1104    cppisocrime:burglary_terr_factor/displayonly ;
1105    cppisocrime:net_premium[2]/displayonly ;
1106    cppisocrime:deductible_premium[2]/displayonly ;
1107    cppisocrime:adjusted_rate[2]/displayonly ;
1108    cppisocrime:rmf_total[1]/displayonly ;
1109    cppisocrime:total_premium[2]/displayonly ;
1201    cppisocrime:minimum_premium[2]/displayonly ;
1301    cppisocrime:final_premium[2]/displayonly ;

}

panel
properties
        {
        Scrollbarpolicy = asneeded
        Text            = "Safe Burglary"
        }
{
%%
*------------------------------------------------------------------------------*
| Limit: __________                                                            |
*------------------------------------------------------------------------------*
| No of Watchpersons:    __    Watchperson Code:       _                       |
| No of Guard Service:   __                                                    |
| Premises/Safe With Key: _    Premises/Safe-NO Keys:  __                      |
| Safe/Vaults With Key:   _    Safe/Vaults-NO Keys:    __                      |
| Holdup Alarms:          _                                                    |
| Bullet Resisting:       _                                                    |
*------------------------------------------------------------------------------*
%%

components

fields

201     cppISOCRIME:LIMIT[2];
401     cppISOCRIME:NO_WATCHPERSONS
        If cppISOCRIME:NO_WATCHPERSONS > CPSCRIMEDEFAULTS:WATCHPERSON_MAX Then
            Error "You have entered more watchpersons then allowed " ;
402     cppISOCRIME:code/uppercase
--        If cppISOCRIME:code <> CPSISOCRDISC_alias:code Then
  --          Error 1262

        Activehelp if cpsisocrdisc_alias:code one of "S", "C", "N" then
                        cpsisocrdisc_alias:code
                   else
                   null/returntofiel/width=1,
                   if cpsisocrdisc_alias:code = "S" then
                       "Central Station"
                   else
                   if cpsisocrdisc_alias:code = "C" then
                    "Clock Registration"
                   else
                   if cpsisocrdisc_alias:code = "N" then
                     "Non-Signaling or Non-Registering" ;

501     cppISOCRIME:NO_GUARDS_SERVICE
 --       If cppISOCRIME:NO_GUARDS_SERVICE > CPSCRIMEDEFAULTS:GUARD_SERVICE_MAX Then
   --         Error "You have entered more guards then allowed"
        if cppISOCRIME:no_guards > 0 then
            l_guard = "G" ;
601     cppISOCRIME:KEY[1]/checkbox/values="0,1";
602     cppISOCRIME:ALARM_SERVICE_NO
--        If cppISOCRIME:ALARM_SERVICE_NO <> CPSCRALARMSERVICE:ALARM_SERVICE_NO Then
  --          Error 1262

        Activehelp if cpsisocralarm_alias:crime_type < 24 then
                       CPSISOCRALARM_ALIAS:Crime_type
                   else
                      null/heading="Alarm"/width=6,
                   if cpsisocralarm_alias:crime_type < 24 then
                        CPSisoCRALARM_ALIAS:grade
                   else
                      null/heading="Grade"/width=6,
                   if cpsisocralarm_alias:crime_type < 24 then
                        CPSisoCRALARM_ALIAS:desc
                   else
                      null/heading="Service"/width=19,
                   if cpsisocralarm_alias:crime_type < 24 then
                        cpsisocralarm_alias:extent_protection
                   else
                      null/heading="Extent of Protection";
701     cppISOCRIME:KEY[2]/checkbox/values="0,1";
702     cppISOCRIME:SAFE_VAULT
--        If cppISOCRIME:ALARM_SERVICE_NO <> CPSCRALARMSERVICE_ALT:ALARM_SERVICE_NO Then
   --         Error 1262
        Activehelp if cpsisocralarm_alt1:crime_type > 24 then
                       CPSISOCRALARM_ALt1:Crime_type
                   else
                      null/heading="Alarm"/width=6,
                   if cpsisocralarm_alt1:crime_type > 24 then
                        CPSisoCRALARM_ALt1:grade
                   else
                      null/heading="Grade"/width=6,
                   if cpsisocralarm_alt1:crime_type > 24 then
                        CPSisoCRALARM_ALt1:desc
                   else
                      null/heading="Service"/width=19,
                   if cpsisocralarm_alt1:crime_type > 24 then
                        cpsisocralarm_alt1:extent_protection
                   else
                      null/heading="Extent of Protection";

801     cppISOCRIME:HOLDUP/uppercase
--        If cppISOCRIME:HOLDUP_ALARMS <> CPSCRHOLDUPALARMS:HOLDUP_ALARMS Then
  --          Error 1262

        Activehelp if cpsisocrdisc_alias:code = "H" then
                        cpsisocrdisc_alias:code
                   else
                   null/returntofield/width=1,
                   if cpsisocrdisc_alias:code = "H" then
                        cpsisocrdisc_alias:desc ;
901     cppISOCRIME:BULLET_code/uppercase
--        If cppISOCRIME:BULLET_ENCLOSURES <> CPSCRBULLET:BULLET_ENCLOSURES Then
  --          Error 1262

        Activehelp if cpsisocrdisc_alias:code one of "A", "B" then
                        cpsisocrdisc_alias:code
                   else
                   null/returntofield/width=1,
                   if cpsisocrdisc_alias:code = "A" then
                        cpsisocrdisc_alias:desc
                   else
                   if cpsisocrdisc_alias:code = "B" then
                        cpsisocrdisc_alias:desc ;

}

panel
properties
        {
        Scrollbarpolicy = asneeded
        Text            = "Amendments"
        }
{
%%
*------------------------------------------------------------------------------*
| Decrease Limit of Insurance while Not Open for Business: _   Limit: ________ |
| Extend Definition to Entire Plot Of Ground:              _                   |
*------------------------------------------------------------------------------*
%%

components

fields

201     cppISOCRIME:business_code/uppercase/default

        Activehelp if cpsisocrdisc_alias:code = "D" then
                        cpsisocrdisc_alias:code
                   else
                   null/returntofield/width=1,
                   if cpsisocrdisc_alias:code = "D" then
                        cpsisocrdisc_alias:desc ;
202     cppISOCRIME:closed_for_business_limit ;
301     cppISOCRIME:Entire_plot/uppercase/default

        Activehelp if cpsisocrdisc_alias:code = "E" then
                        cpsisocrdisc_alias:code
                   else
                   null/returntofield/width=1,
                   if cpsisocrdisc_alias:code = "E" then
                        cpsisocrdisc_alias:desc ;

}


panel
properties
        {
        Scrollbarpolicy = asneeded
        Text            = "Outside Coverage Premises"
        }
{

%%
*----------------------------------------------------------------------------------------*
| No of Messengers:      __    No of Guards:  __             Limit:  __________          |
| Conveyance Safeguards: __    Conveyed by Armored Vehicle _                             |
*----------------------------------------------------------------------------------------*
| Coverage            Actual Exposure     Factor     Multiplier                          |
*----------------------------------------------------------------------------------------*
| Basic:                 _________        ______      _________                          |
| Add'l:                 _________        ______      _________                          |
| Gross Premium:                                      _________                          |
*----------------------------------------------------------------------------------------*
|  Gross       Total      Terr       Net     Deductible    Adj                  Final    |
| Premium      Disc       Mult     Premium     Credit    Premium       RMF     Premium   |
*----------------------------------------------------------------------------------------*
| _________  _________  _________  _________  _________  _________  _________  _________ |
|                                          Balance to Meet Minimum:            _________ |
|                                          Total Premium:                      _________ |
*----------------------------------------------------------------------------------------*

%%

components

fields

201     cppISOCRIME:NO_MESSENGERS;
202     cppISOCRIME:NO_GUARDS;
203     cppISOCRIME:LIMIT[3];
301     cppISOCRIME:conveyance_code
--        If cppISOCRIME:CONVEYANCE <> CPSCRCONVEYANCE:CONVEYANCE_NO Then
  --          Error 1262

        Activehelp if cpsisocrdisc_alias:code one of "I", "J", "K" then
                        cpsisocrdisc_alias:code
                   else
                   null/returntofield/width=1,
                   if cpsisocrdisc_alias:code = "I" then
                        cpsisocrdisc_alias:desc
                   else
                   if cpsisocrdisc_alias:code = "J" then
                        cpsisocrdisc_alias:desc
                   else
                   if cpsisocrdisc_alias:code = "K" then
                        cpsisocrdisc_alias:desc;
302     cppisocrime:Armored_motor_vehicle/checkbox/values="0,1";
701     cppISOCRIME:money_exposure[2] ;
702     begin
        if function one of "ADD", "CHANGE" then
            begin
            L_COVERAGE_CODE = "B"
            if cppisocrime:armored_motor_vehicle = 0 then
                Do GET_MESSENGERS_FACTOR
            if cppisocrime:armored_motor_vehicle = 1 then
                begin
                cppisocrime:no_guards = 6
                do GET_MESSENGERS_FACTOR
                cppisocrime:armored_Vehicle_factor = l_factor2
                cppisocrime:no_guards = 2
                do GET_MESSENGERS_FACTOR
                l_factor2 = l_factor2 * cppisocrime:armored_vehicle_factor
                end
            cppisocrime:base_factor_outside[1] = l_factor2
            end
        end
        cppisocrime:base_factor_outside[1]/displayonly ;
703     begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:crime_total_1[1] = (cppisocrime:base_factor_outside[1] * (cppISOCRIME:money_exposure[2] divide l_outside_per))
        end
        cppISOCRIME:crime_total_1[1]/displayonly ;
801     begin
        if function one of "ADD", "CHANGE" then
            begin
            l_money_excess = cppISOCRIME:limit[3] - cppISOCRIME:money_exposure[2] -
                             cppISOCRIME:securities_exposure[2] - cppISOCRIME:checks_exposure[2] -
                             cppISOCRIME:payroll_exposure[2]
            if l_money_excess > 0 then
                cppISOCRIME:excess_exposure[2] = l_money_excess
            end
        end
        cppISOCRIME:excess_exposure[2]/default ;
802     begin
        if function one of "ADD", "CHANGE" then
            cppisocrime:base_factor_outside[2] = cppisocrime:base_factor_outside[1]
        end
        cppisocrime:base_factor_outside[2]/displayonly ;
803     begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:excess_multiplier[2] = (cppisocrime:base_factor_outside[1] * (cppISOCRIME:excess_exposure[2] divide l_outside_per))
        end
        cppISOCRIME:excess_multiplier[2]/displayonly ;
901     begin
        if function one of "ADD", "CHANGE" then
            cppISOCRIME:gross_premium[3] = (cppISOCRIME:crime_total_1[1] +
                                            cppISOCRIME:excess_multiplier[2])
        end
        cppISOCRIME:gross_premium[3]/displayonly ;
1401    begin
        if function one of "ADD", "CHANGE" then
            do get_totals
        end
        cppisocrime:gross_premium[3]/displayonly ;
1402    begin
            l_deviation = 1.00
        end
        l_deviation/displayonly ;
1403    cppisocrime:mess_terr_factor/displayonly ;
1404    cppisocrime:net_premium[3]/displayonly ;
1405    cppisocrime:deductible_premium[3]/displayonly ;
1406    cppisocrime:adjusted_rate[3]/displayonly ;
1407    cppisocrime:rmf_total[1]/displayonly ;
1408    cppisocrime:total_premium[3]/displayonly ;
1501    cppisocrime:minimum_premium[3]/displayonly ;
1601    cppisocrime:final_premium[3]/displayonly ;

}

}

}

Procedure Definition

procedure get_totals
begin
Do GET_DEDUCTIBLE_FACTOR
Do GET_MINIMUM_PREMIUM

If cppISOCRIME:code <> " " Then
    Do GET_WATCHPERSON_RATES
Else
    L_WATCHPERSON_FACTOR = 1.00

If cppISOCRIME:NO_GUARDS_SERVICE <> 0 Then
    Do GET_GUARDS_SERVICE
Else
    L_GUARDSERVICE_FACTOR = 1.00

if cppISOCRIME:NO_MESSENGERS > 1 then
    DO GET_MESSENGERS
else
    l_multi_messenger_factor = 1.00

If cppISOCRIME:ALARM_SERVICE_NO <> 0 Then
    Do GET_ALARM_SERVICE
Else
    L_ALARM_FACTOR = 1.00

If cppISOCRIME:SAFE_VAULT <> 0 Then
    Do GET_SAFE_SERVICE
Else
    L_SAFE_FACTOR = 1.00

If cppISOCRIME:HOLDUP <> " " Then
    Do GET_HOLDUP_ALARMS
Else
    L_HOLDUP_FACTOR = 1.00

If cppISOCRIME:BULLET_Code <> " " Then
    Do GET_BULLET_RATES
Else
    L_BULLET_FACTOR = 1.00

L_Bond_Excess_factor1 = 1.00

If cppISOCRIME:CONVEYANCE_code <> " " Then
    Do GET_CONVEYANCE_RATES
Else
    L_CONVEYANCE_FACTOR = 1.00

l_limit = cppisocrime:limit[3]
DO LIMIT_EXCESS
IF l_LIMIT > 0 then
    begin
    l_section = "M"
    Do GET_BOND_EXCESS_RATES
    end
Else
    L_Bond_Excess_factor2 = 1.00

If cppISOCRIME:business_code = "D" Then
    begin
    l_business_closed_premium = (cppisocrime:base_factor_inside[1] * (cppISOCRIME:closed_for_business_limit divide l_inside_per))
    Do GET_Business_code_factor
    end
Else
    begin
    L_business_code_FACTOR = 1.00
    end

If cppISOCRIME:entire_plot = "E" Then
    begin
    Do GET_entire_plot_factor
    end
Else
    begin
    L_entire_plot_FACTOR = 1.00
    end

access cppcrime1, set cppcrime1:policy_no = g_policy_no,
                      cppcrime1:pol_year = g_year,
                      cppcrime1:end_sequence = g_end_sequence,
                      cppcrime1:prem_no  = g_prem_no,
                      cppcrime1:build_no = g_build_no, generic

l_crime1_terr = cppcrime1:terr

Do GET_TERRITORY_FACTOR
DO GET_RMF_FACTOR
Do APPLY_DISCOUNTS_CUSTODIAN_PREMISES
Do APPLY_DISCOUNTS_SAFE_PREMISES
Do APPLY_AMENDMENTS_PREMISES

cppisocrime:deductible_factor         = l_deductible_factor
cppisocrime:TERRITORY_FACTOR          = L_prem_TERR_FACTOR
cppisocrime:mess_terr_factor          = l_mess_terr_factor
cppisocrime:burglary_terr_factor      = l_safe_terr_factor
cppisocrime:WATCHPERSON_FACTOR        = L_WATCHPERSON_FACTOR
cppisocrime:GUARD_SERVICE_FACTOR      = L_GUARDSERVICE_FACTOR
cppisocrime:ALARM_SERVICE_FACTOR      = L_ALARM_FACTOR
cppisocrime:SAFE_SERVICE_FACTOR       = L_SAFE_FACTOR
if cppisocrime:business_code ="D" then
    begin
    cppisocrime:each_addl_factor[1]   = 1.00
    cppisocrime:each_addl_factor[2]   = 1.00
    end
else
    begin
    cppisocrime:each_addl_factor[1]   = l_bond_excess_factor1
    cppisocrime:each_addl_factor[2]   = l_bond_excess_factor2
    end
cppisocrime:multi_messenger_factor    = L_MULTI_MESSENGER_FACTOR
cppisocrime:business_code_factor      = L_BUSINESS_CODE_FACTOR
cppisocrime:entire_plot_factor        = L_ENTIRE_PLOT_FACTOR
cppisocrime:HOLDUP_ALARMS_FACTOR      = L_HOLDUP_FACTOR
cppisocrime:BULLET_FACTOR             = L_BULLET_FACTOR
cppisocrime:CONVEYANCE_FACTOR         = L_CONVEYANCE_FACTOR
cppisocrime:rmf_total[1]              = l_rmf_factor
cppisocrime:net_premium[1]            = (l_adjusted_rate1 *
                                        cppisocrime:base_factor_inside[4] *
                                        l_prem_terr_factor)
if l_deductible_factor = 0 then
    cppisocrime:deductible_premium[1] = 0
else
    cppisocrime:deductible_premium[1] = ((cppisocrime:gross_premium[1] * l_deductible_factor) divide
                                        (cppisocrime:money_exposure[1] divide l_inside_per))

cppisocrime:ADJUSTED_RATE[1]          = cppisocrime:net_premium[1] -
                                        cppisocrime:DEDUCTIBLE_Premium[1]

If cppisocrime:ADJUSTED_RATE[1] < L_INSIDE_MINIMUM Then
    L_INSIDE_MINIMUM_YES = "Y"
else
    l_inside_minimum_Yes = "N"

l_total_premium = cppisocrime:adjusted_rate[1] *
                  cppisocrime:rmf_total[1]
cppisocrime:total_premium[1] = l_total_premium

if l_inside_minimum_yes = "Y" then
    begin
    l_minimum_total1               = cppisocrime:total_premium[1]
    cppisocrime:minimum_premium[1] = ((l_inside_minimum *
                                     cppisocrime:rmf_total[1]) -
                                     cppisocrime:total_premium[1])
    cppisocrime:final_premium[1]   = cppisocrime:minimum_premium[1] +
                                     cppisocrime:total_premium[1]
    end
else
    begin
    l_minimum_total1               = 0
    cppisocrime:minimum_premium[1] = 0
    cppisocrime:final_premium[1]   = cppisocrime:total_premium[1]
    l_inside_minimum               = 0
    end

cppisocrime:net_premium[2] = (l_adjusted_rate2 *
                             cppisocrime:base_factor_inside[5] *
                             l_safe_terr_factor)
if l_deductible_factor = 0 then
    cppisocrime:deductible_premium[2] = 0
else
    cppisocrime:deductible_premium[2] = ((cppisocrime:gross_premium[2] * l_deductible_factor) divide
                                        (cppisocrime:securities_exposure[1] divide l_inside_per))

cppisocrime:ADJUSTED_RATE[2] = cppisocrime:net_premium[2] -
                               cppisocrime:DEDUCTIBLE_Premium[2]

If cppisocrime:ADJUSTED_RATE[2] < L_INSIDE_MINIMUM Then
    L_INSIDE_MINIMUM_YES = "Y"
else
    l_inside_minimum_Yes = "N"

l_total_premium = cppisocrime:adjusted_rate[2] *
                  cppisocrime:rmf_total[1]
cppisocrime:total_premium[2] = l_total_premium

if l_inside_minimum_yes = "Y" then
    begin
    l_minimum_total2               = cppisocrime:total_premium[2]
    cppisocrime:minimum_premium[2] = ((l_safe_minimum *
                                     cppisocrime:rmf_total[1]) -
                                     cppisocrime:total_premium[2])
    cppisocrime:final_premium[2]   = cppisocrime:minimum_premium[2] +
                                     cppisocrime:total_premium[2]
    end
else
    begin
    l_minimum_total2               = 0
    cppisocrime:minimum_premium[2] = 0
    cppisocrime:final_premium[2]   = cppisocrime:total_premium[2]
    l_safe_minimum                 = 0
    end

DO APPLY_DISCOUNTS_MESSENGER
cppisocrime:net_premium[3] = (cppisocrime:gross_premium[3] *
                             l_mess_terr_factor)

if l_deductible_factor = 0 then
    cppisocrime:deductible_premium[3] = 0
else
    cppisocrime:deductible_premium[3] = ((cppisocrime:gross_premium[3] *
                                        l_deductible_factor) divide
                                        (cppisocrime:money_exposure[2] divide
                                        l_outside_per))

cppisocrime:ADJUSTED_RATE[3] = cppisocrime:net_premium[3] -
                               cppisocrime:DEDUCTIBLE_premium[3]

If cppisocrime:ADJUSTED_RATE[3] < L_OUTSIDE_MINIMUM Then
    L_OUTSIDE_MINimum_yes = "Y"
else
    l_outside_minimum_yes = "N"

if cppisocrime:no_messengers > 1 then
    begin
    for l_mess = 2 to cppisocrime:no_messengers
        begin
        l_sub = l_mess + 2
        cppisocrime:gross_premium[l_sub] = (cppISOCRIME:crime_total_1[1] +
                                            cppISOCRIME:crime_total_1[2] +
                                            cppISOCRIME:crime_total_1[3] +
                                            cppISOCRIME:crime_total_1[4])
        DO APPLY_DISCOUNTS_MESSENGER_MULTI
        cppisocrime:net_premium[l_sub] = (l_ADJUSTED_RATE3 *
                                          l_mess_terr_factor)
        cppisocrime:adjusted_rate[l_sub] = cppisocrime:net_premium[l_sub] -
                                           cppisocrime:deductible_premium[2]
        If cppisocrime:ADJUSTED_RATE[l_sub] < L_OUTSIDE_MINIMUM Then
            L_OUTSIDE_MINimum_yes = "Y"
        else
            l_outside_minimum_yes = "N"
        if l_outside_minimum_yes = "Y"then
            cppisocrime:total_premium[l_sub] =  l_outside_each_addl
        else
            begin
            cppisocrime:total_premium[l_sub] = cppisocrime:adjusted_rate[l_sub] * cppisocrime:rmf_total[1]
            l_outside_each_addl = 0
            end
        end
    end

l_total_premium = cppisocrime:adjusted_rate[3] * cppisocrime:rmf_total[1]
cppisocrime:total_premium[3] = l_total_premium

if l_outside_minimum_yes = "Y" then
    begin
    l_minimum_total3               = cppisocrime:total_premium[3]
    cppisocrime:minimum_premium[3] = ((l_outside_minimum *
                                     cppisocrime:rmf_total[1]) -
                                     cppisocrime:total_premium[3])
    cppisocrime:final_premium[3]   = cppisocrime:minimum_premium[3] +
                                     cppisocrime:total_premium[3]
    end
else
    begin
    l_minimum_total3               = 0
    cppisocrime:minimum_premium[3] = 0
    cppisocrime:final_premium[3]   = cppisocrime:total_premium[3]
    l_outside_minimum              = 0
    end

l_premium = cppisocrime:final_premium[1] +
            cppisocrime:final_premium[2] +
            cppisocrime:final_premium[3]

cppisocrime:crime_premium = l_premium

if cppcrime1:policy_no = g_policy_no and
   cppcrime1:prem_no  = g_prem_no and
   cppcrime1:build_no = g_build_no and
   cppcrime1:sub_code = g_sub_code then
    begin
    change cppcrime1
        begin
        cppcrime1:total_premium = cppisocrime:crime_premium
        cppcrime1:premium       = cppcrime1:total_premium
        end
    end

end

Procedure APPLY_DISCOUNTS_CUSTODIAN_PREMISES
begin
l_ADJUSTED_RATE1 = cppISOCRIME:gross_premium[1] * L_SAFE_Factor
l_adjusted_rate1 = l_adjusted_rate1 * l_alarm_factor
l_adjusted_rate1 = l_adjusted_rate1 * l_holdup_factor
l_adjusted_rate1 = l_adjusted_rate1 * l_bullet_factor
l_adjusted_rate1 = l_adjusted_rate1 * l_bond_excess_factor1
l_adjusted_rate1 = l_adjusted_rate1 * l_guardservice_factor
l_adjusted_rate1 = l_adjusted_rate1 * L_WATCHPERSON_FACTOR

End

Procedure APPLY_DISCOUNTS_SAFE_PREMISES
begin
l_ADJUSTED_RATE2 = cppISOCRIME:gross_premium[2] * L_SAFE_Factor
l_adjusted_rate2 = l_adjusted_rate2 * l_alarm_factor
l_adjusted_rate2 = l_adjusted_rate2 * l_holdup_factor
l_adjusted_rate2 = l_adjusted_rate2 * l_bullet_factor
l_adjusted_rate2 = l_adjusted_rate2 * l_bond_excess_factor1
l_adjusted_rate2 = l_adjusted_rate2 * l_guardservice_factor
l_adjusted_rate2 = l_adjusted_rate2 * L_WATCHPERSON_FACTOR

End

Procedure APPLY_Amendments_PREMISES
begin
if cppisocrime:business_code = "D" then
    begin
    l_business_closed_credit = cppisocrime:crime_total[1]-l_business_closed_premium
    l_adjusted_rate1 = l_business_closed_credit * l_business_code_factor
    l_adjusted_rate1 = l_adjusted_rate1 + l_business_closed_premium
    end
else
    l_adjusted_rate1 = l_adjusted_rate1 * l_entire_plot_factor

End

Procedure APPLY_DISCOUNTS_MESSENGER
begin
l_ADJUSTED_RATE3 = cppISOCRIME:gross_premium[3] * L_conveyance_Factor
l_adjusted_rate3 = l_adjusted_rate3 * l_bond_excess_factor2

End

Procedure APPLY_DISCOUNTS_MESSENGER_MULTI
begin
l_ADJUSTED_RATE4 = cppisocrime:gross_premium[l_sub] * l_multi_messenger_factor
l_adjusted_rate4 = l_adjusted_rate4 * L_conveyance_Factor

End

Procedure LIMIT_EXCESS
Begin
IF l_limit < 50000 then
    l_limit = 0
if l_limit > 49999 and
   l_limit < 100000 then
    l_limit = 50000
if l_limit > 99999 and
   l_limit < 250000 then
    l_limit = 100000
if l_limit > 249999 and
   l_limit < 500000 then
    l_limit = 250000
if l_limit > 499999 and
   l_limit < 1000000 then
    l_limit = 500000
if l_limit > 999999 and
   l_limit < 1500000 then
    l_limit = 1000000
if l_limit > 1499999 and
   l_limit < 2000000 then
    l_limit = 1500000
if l_limit > 1999999 and
   l_limit < 2500000 then
    l_limit = 2000000
if l_limit > 2499999 and
   l_limit < 3000000 then
    l_limit = 2500000
if l_limit > 2999999 and
   l_limit < 3500000 then
    l_limit = 3000000
if l_limit > 3499999 and
   l_limit < 4000000 then
    l_limit = 3500000
if l_limit > 3999999 and
   l_limit < 4500000 then
    l_limit = 4000000
if l_limit > 4499999 and
   l_limit < 5000000 then
    l_limit = 4500000
if l_limit > 4999999  then
    l_limit = 5000000

end

Procedure GET_BOND_EXCESS_RATES
begin
Access CPSISOCRBOND, Set CPSISOCRBOND:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRBOND:STATE            = cppISOCRIME:STATE,
                         CPSISOCRBOND:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                         CPSISOCRBOND:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         CPSISOCRBOND:SECTION          = l_section,
                         CPSISOCRBOND:LIMIT            = l_limit, Generic

While CPSISOCRBOND:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRBOND:STATE            = cppISOCRIME:STATE And
      CPSISOCRBOND:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRBOND:CRIME_FORM       = cppISOCRIME:CRIME_FORM and
      CPSISOCRBOND:SECTION          = L_SECTION and
      CPSISOCRBOND:LIMIT            = L_LIMIT
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRBOND:EFF_DATE Then
            Begin
            if l_section = "P" then
                L_BOND_EXCESS_FACTOR1 = CPSISOCRBOND:factor
            if l_section = "M" then
                l_bond_excess_factor2 = cpsisocrbond:factor
            End

        Next CPSISOCRBOND
        End

End

Procedure GET_RMF_FACTOR
Begin
Access SFSLOSSCOST, Set sfslosscost:COMPANY_ID       = sfpNAME:COMPANY_ID,
                        sfslosscost:STATE            = cppISOCRIME:STATE,
                        sfslosscost:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS, Generic

While sfslosscost:COMPANY_ID       = sfpNAME:COMPANY_ID And
      sfslosscost:STATE            = cppISOCRIME:STATE And
      sfslosscost:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS
        Begin
        If sfpNAME:EFF_DATE >= sfslosscost:EFF_DATE Then
            begin
            l_loss_cost = sfslosscost:rate_1[2]
            end

        Next sfslosscost
        End

l_rmf_factor = ((l_loss_cost * cppcrime1:package_mod) * cppcrime1:company_deviation)
if l_rmf_factor = 0 then
   l_rmf_factor = 1.00

End

Procedure GET_DEDUCTIBLE_FACTOR
Begin
Access CPSISOCRDED, Set CPSISOCRDED:COMPANY_ID       = sfpNAME:COMPANY_ID,
                        CPSISOCRDED:STATE            = cppISOCRIME:STATE,
                        CPSISOCRDED:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                        CPSISOCRDED:DEDUCTIBLE       = cppISOCRIME:DEDUCTIBLE, Generic

While CPSISOCRDED:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDED:STATE            = cppISOCRIME:STATE And
      CPSISOCRDED:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRDED:DEDUCTIBLE       = cppISOCRIME:DEDUCTIBLE
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDED:EFF_DATE Then
            Begin
            L_DEDUCTIBLE_FACTOR = CPSISOCRDED:multiplier
            End

        Next CPSISOCRDED
        End

End

Procedure GET_MINIMUM_PREMIUM
Begin
Access CPSISOCRMINIMUMS, Set CPSISOCRMINIMUMS:COMPANY_ID       = sfpNAME:COMPANY_ID,
                             CPSISOCRMINIMUMS:STATE            = cppISOCRIME:STATE,
                             CPSISOCRMINIMUMS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                             CPSISOCRMINIMUMS:CRIME_FORM       = cppISOCRIME:CRIME_FORM, generic

While CPSISOCRMINIMUMS:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRMINIMUMS:STATE            = cppISOCRIME:STATE And
      CPSISOCRMINIMUMS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRMINIMUMS:CRIME_FORM       = cppISOCRIME:CRIME_FORM
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRMINIMUMS:EFF_DATE Then
            Begin
            L_INSIDE_MINIMUM    = CPSISOCRMINIMUMS:FIRST_PREMISES[1]
            L_INSIDE_EACH_ADDL  = CPSISOCRMINIMUMS:EACH_ADDITIONAL[1]
            l_safe_minimum      = cpsisocrminimums:first_premises[2]
            l_safe_each_addl    = cpsisocrminimums:each_additional[2]
            L_OUTSIDE_MINIMUM   = CPSISOCRMINIMUMS:FIRST_messenger
            L_OUTSIDE_EACH_ADDL = CPSISOCRMINIMUMS:EACH_ADDITIONAL[3]
            End

        Next CPSISOCRMINIMUMS
        End

End

Procedure GET_BASE_FACTOR
Begin
Access CPSISOCRFACTORS, Set CPSISOCRFACTORS:COMPANY_ID       = sfpNAME:COMPANY_ID,
                            CPSISOCRFACTORS:STATE            = cppISOCRIME:STATE,
                            CPSISOCRFACTORS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                            CPSISOCRFACTORS:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                            CPSISOCRFACTORS:CODE             = L_MISC_CODE, Generic

While CPSISOCRFACTORS:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRFACTORS:STATE            = cppISOCRIME:STATE And
      CPSISOCRFACTORS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRFACTORS:CRIME_FORM       = cppISOCRIME:CRIME_FORM and
      CPSISOCRFACTORS:CODE             = L_MISC_CODE
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRFACTORS:EFF_DATE Then
            Begin
            L_FACTOR1 = CPSISOCRFACTORS:FACTOR[1]
            l_factor2 = CPSISOCRFACTORS:FACTOR[2]
            End

        Next CPSISOCRFACTORS
        End

End

Procedure GET_MESSENGERS_FACTOR
Begin
Access CPSISOCRGUARD, Set CPSISOCRGUARD:COMPANY_ID       = sfpNAME:COMPANY_ID,
                          CPSISOCRGUARD:STATE            = cppISOCRIME:STATE,
                          CPSISOCRGUARD:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                          CPSISOCRGUARD:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                          CPSISOCRGUARD:COVERAGE         = L_COVERAGE_CODE,
                          CPSISOCRGUARD:NO_GUARDS        = cppISOCRIME:NO_GUARDS, Generic

While CPSISOCRGUARD:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRGUARD:STATE            = cppISOCRIME:STATE And
      CPSISOCRGUARD:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRGUARD:CRIME_FORM       = cppISOCRIME:CRIME_FORM and
      CPSISOCRGUARD:COVERAGE         = L_COVERAGE_CODE and
      CPSISOCRGUARD:NO_GUARDS        = cppISOCRIME:NO_GUARDS
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRGUARD:EFF_DATE Then
            Begin
            L_FACTOR2 = CPSISOCRGUARD:FACTOR
            End

        Next CPSISOCRGUARD
        End

End

Procedure GET_PER_AMOUNT
Begin
l_MISC_CODE = "Z"
Access CPSISOCRFACTORS, Set CPSISOCRFACTORS:COMPANY_ID       = sfpNAME:COMPANY_ID,
                            CPSISOCRFACTORS:STATE            = cppISOCRIME:STATE,
                            CPSISOCRFACTORS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                            CPSISOCRFACTORS:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                            CPSISOCRFACTORS:CODE             = L_MISC_CODE, Generic

While CPSISOCRFACTORS:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRFACTORS:STATE            = cppISOCRIME:STATE And
      CPSISOCRFACTORS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRFACTORS:CRIME_FORM       = cppISOCRIME:CRIME_FORM and
      CPSISOCRFACTORS:CODE             = L_MISC_CODE
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRFACTORS:EFF_DATE Then
            Begin
            L_INSIDE_PER  = CPSISOCRFACTORS:PER[1]
            L_OUTSIDE_PER = CPSISOCRFACTORS:PER[2]
            End

        Next CPSISOCRFACTORS
        End

End

Procedure GET_TERRITORY_FACTOR
Begin
if cppISOCRIME:plan = 1 then
    Access CPSISOCRTERR, Set CPSISOCRTERR:COMPANY_ID       = sfpNAME:COMPANY_ID,
                             CPSISOCRTERR:STATE            = cppISOCRIME:STATE,
                             CPSISOCRTERR:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                             CPSISOCRTERR:territory_code   = l_CRIME1_terr,
                             CPSISOCRTERR:plan             = cppISOCRIME:plan,
                             CPSISOCRTERR:CRIME_FORM       = cppISOCRIME:CRIME_FORM, generic
else
if cppISOCRIME:plan > 1 then
    Access CPSISOCRTERR, Set CPSISOCRTERR:COMPANY_ID       = sfpNAME:COMPANY_ID,
                             CPSISOCRTERR:STATE            = cppISOCRIME:STATE,
                             CPSISOCRTERR:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                             CPSISOCRTERR:territory_code   = l_crime1_terr,
                             CPSISOCRTERR:plan             = cppISOCRIME:plan, generic


While CPSISOCRTERR:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRTERR:STATE            = cppISOCRIME:STATE And
      CPSISOCRTERR:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRTERR:territory_code   = l_CRIME1_terr and
      cpsisocrterr:plan             = cppisocrime:plan and
      CPSISOCRTERR:CRIME_FORM       = cppISOCRIME:CRIME_FORM
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRTERR:EFF_DATE Then
            Begin
            L_Prem_TERR_FACTOR = CPSISOCRTERR:FACTOR[1]
            l_Mess_terr_factor = cpsisocrterr:factor[3]
            l_safe_terr_factor = cpsisocrterr:factor[2]
            End

        Next CPSISOCRTERR
        End

End

Procedure GET_WATCHPERSON_RATES
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                         cpsisocrdisc:crime_form       = cppISOCRIME:crime_form,
                         CPSISOCRDISC:code             = cppISOCRIME:code, Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      cpsisocrdisc:crime_form       = cppISOCRIME:crime_form and
      CPSISOCRDISC:code             = cppISOCRIME:code
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_WATCHPERSON_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_GUARDS_SERVICE
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRdisc:STATE            = cppISOCRIME:STATE,
                         CPSISOCRdisc:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                         CPSISOCRdisc:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         cpsisocrdisc:code             = l_guard, Generic

While CPSISOCRdisc:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSisoCRdisc:STATE            = cppISOCRIME:STATE And
      CPSisoCRdisc:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSisoCRdisc:CRIME_FORM       = cppISOCRIME:CRIME_FORM  and
      cpsisocrdisc:code             = l_guard
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRdisc:EFF_DATE Then
            Begin
            L_GUARDSERVICE_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_ALARM_SERVICE
Begin
Access CPSISOCRALARM, Set CPSISOCRALARM:COMPANY_ID       = sfpNAME:COMPANY_ID,
                          CPSISOCRALARM:STATE            = cppISOCRIME:STATE,
                          CPSISOCRALARM:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                          CPSISOCRALARM:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                          CPSISOCRALARM:CRIME_TYPE       = cppISOCRIME:alarm_service_no, Generic

While CPSISOCRALARM:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRALARM:STATE            = cppISOCRIME:STATE And
      CPSISOCRALARM:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRALARM:CRIME_FORM       = cppISOCRIME:CRIME_FORM  And
      CPSISOCRALARM:CRIME_TYPE       = cppISOCRIME:ALARM_SERVICE_NO
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRALARM:EFF_DATE Then
            Begin
            if cppISOCRIME:key[1] = 1 then
                L_ALARM_FACTOR = CPSISOCRALARM:FACTOR[1]
            else
            if cppISOCRIME:key[1] = 0 then
                L_ALARM_FACTOR = CPSISOCRALARM:FACTOR[2]
            End

        Next CPSISOCRALARM
        End

end

Procedure GET_SAFE_SERVICE
Begin
Access CPSISOCRALARM, Set CPSISOCRALARM:COMPANY_ID       = sfpNAME:COMPANY_ID,
                          CPSISOCRALARM:STATE            = cppISOCRIME:STATE,
                          CPSISOCRALARM:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                          CPSISOCRALARM:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                          CPSISOCRALARM:CRIME_TYPE       = cppISOCRIME:SAFE_VAULT, Generic

While CPSISOCRALARM:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRALARM:STATE            = cppISOCRIME:STATE And
      CPSISOCRALARM:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      CPSISOCRALARM:CRIME_FORM       = cppISOCRIME:CRIME_FORM  And
      CPSISOCRALARM:CRIME_TYPE       = cppISOCRIME:SAFE_VAULT
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRALARM:EFF_DATE Then
            Begin
            if cppISOCRIME:key[2] = 1 then
                L_SAFE_FACTOR = CPSISOCRALARM:FACTOR[1]
            else
            if cppISOCRIME:key[2] = 0 then
                L_SAFE_FACTOR = CPSISOCRALARM:FACTOR[2]
            End

        Next CPSISOCRALARM
        End

End

Procedure GET_HOLDUP_ALARMS
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business,
                         CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         CPSISOCRDISC:code             = cppISOCRIME:HOLDUP, Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business And
      CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM  And
      CPSISOCRDISC:code             = cppISOCRIME:HOLDUP
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_HOLDUP_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_BULLET_RATES
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business,
                         cpsisocrdisc:crime_form       = cppISOCRIME:crime_form,
                         CPSISOCRDISC:code             = cppISOCRIME:BULLET_code, Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business And
      cpsisocrdisc:crime_form       = cppISOCRIME:crime_form and
      CPSISOCRDISC:code             = cppISOCRIME:BULLET_code
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_BULLET_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_FORM_MULTI
Begin
Access CPSISOCRROB, Set CPSISOCRROB:COMPANY_ID       = sfpNAME:COMPANY_ID,
                        CPSISOCRROB:STATE            = cppISOCRIME:STATE,
                        CPSISOCRROB:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                        cpsisocrrob:crime_form       = g_crime_form,
                        cpsisocrrob:crime_type       = l_crime_type,
                        cpsisocrrob:grouptype        = l_group_type,
                        cpsisocrrob:safe_class       = l_safe_class, approximate


While CPSISOCRROB:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSisocrrob:STATE            = cppISOCRIME:STATE And
      CPSisocrrob:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      cpsisocrrob:crime_form       = cppISOCRIME:crime_form and
      cpsisocrrob:crime_type       = l_crime_type and
      cpsisocrrob:grouptype        = l_group_type and
      cpsisocrrob:safe_class       = l_safe_class
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRROB:EFF_DATE Then
            Begin
            L_FACTOR1 = CPSISOCRROB:FACTOR
            l_robbery_code = cpsisocrrob:code
            End

        Next CPSISOCRROB
        End

End

Procedure GET_ROBBERY
Begin
Access CPSISOCRROB, Set CPSISOCRROB:COMPANY_ID       = sfpNAME:COMPANY_ID,
                        CPSISOCRROB:STATE            = cppISOCRIME:STATE,
                        CPSISOCRROB:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                        cpsisocrrob:crime_form       = g_crime_form,
                        cpsisocrrob:crime_type       = l_crime_type,
                        cpsisocrrob:grouptype        = l_group,
                        cpsisocrrob:safe_class       = l_safe_class, approximate


While CPSISOCRROB:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSisocrrob:STATE            = cppISOCRIME:STATE And
      CPSisocrrob:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      cpsisocrrob:crime_form       = cppISOCRIME:crime_form and
      cpsisocrrob:crime_type       = l_crime_type and
      cpsisocrrob:grouptype        = l_group and
      cpsisocrrob:safe_class       = l_safe_class
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRROB:EFF_DATE Then
            Begin
            L_FACTOR1 = CPSISOCRROB:FACTOR
            l_robbery_code = cpsisocrrob:code
            End

        Next CPSISOCRROB
        End

End

Procedure GET_SAFE_CLASS
Begin
Access CPSISOCRMONEYFAC, Set CPSISOCRMONEYFAC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                             CPSISOCRMONEYFAC:STATE            = cppISOCRIME:STATE,
                             CPSISOCRMONEYFAC:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                             cpsisocrmoneyfac:crime_form       = cppISOCRIME:crime_form,
                             cpsisocrmoneyfac:rate_group       = cppISOCRIME:rate_group,
                             cpsisocrmoneyfac:safe_class       = cppISOCRIME:safe_class, Generic

While CPSISOCRMONEYFAC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSisoCRMONEYFAC:STATE            = cppISOCRIME:STATE And
      CPSisoCRMONEYFAC:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS And
      cpsisocrmoneyfac:crime_form       = cppISOCRIME:crime_form and
      cpsisocrmoneyfac:rate_group       = cppISOCRIME:rate_group and
      cpsisocrmoneyfac:safe_class       = cppISOCRIME:safe_class
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRMONEYFAC:EFF_DATE Then
            Begin
            L_FACTOR1 = CPSISOCRMONEYFAC:FACTOR
            l_safe_class_code = cpsisocrmoneyfac:code
            End

        Next CPSISOCRMONEYFAC
        End

End

Procedure GET_CONVEYANCE_RATES
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business,
                         CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         CPSISOCRDISC:code             = cppISOCRIME:CONVEYANCE_code , Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business And
      CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM And
      CPSISOCRDISC:CODE             = cppISOCRIME:CONVEYANCE_CODE
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_CONVEYANCE_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_MESSENGERS
Begin
l_messenger = "F"
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business,
                         CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         CPSISOCRDISC:code             = l_messenger , Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business And
      CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM And
      CPSISOCRDISC:CODE             = l_messenger
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_MULTI_MESSENGER_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_business_code_factor
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business,
                         CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         CPSISOCRDISC:code             = cppISOCRIME:business_code , Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business And
      CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM And
      CPSISOCRDISC:CODE             = cppISOCRIME:business_code
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_business_code_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

Procedure GET_entire_plot_factor
Begin
Access CPSISOCRDISC, Set CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID,
                         CPSISOCRDISC:STATE            = cppISOCRIME:STATE,
                         CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business,
                         CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM,
                         CPSISOCRDISC:code             = cppISOCRIME:entire_plot , Generic

While CPSISOCRDISC:COMPANY_ID       = sfpNAME:COMPANY_ID And
      CPSISOCRDISC:STATE            = cppISOCRIME:STATE And
      CPSISOCRDISC:LINE_OF_BUSINESS = l_line_of_business And
      CPSISOCRDISC:CRIME_FORM       = cppISOCRIME:CRIME_FORM And
      CPSISOCRDISC:CODE             = cppISOCRIME:entire_plot
        Begin
        If sfpNAME:EFF_DATE >= CPSISOCRDISC:EFF_DATE Then
            Begin
            L_entire_plot_FACTOR = CPSISOCRDISC:FACTOR
            End

        Next CPSISOCRDISC
        End

End

End
