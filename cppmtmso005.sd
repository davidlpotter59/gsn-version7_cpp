%%
Screen
        Name            = "cppmtmso005";
        Type            = "Multiline" ;
        Repeat line_items, 10 Times ;
        Screensize      = "dynamic" ;
        Highlight       = Underscore ;
        Padcharacter    = Space ;
        Domain          = "cppCRIME1" ;
        Windowtitle = "%a    %s Crime - Ver 7.00     %m" ;
        iconline        = 0;

        Global Unsigned Ascii Number G_policy_NO[9] ,
                                     g_year[4],
                                     g_end_sequence[4],
                                     G_PREM_NO[4] ,
                                     G_BUILD_NO[4] ,
                                     G_SUB_CODE[4] ,
                                     g_state[2],
                                     g_county[3];

        Global Signed Ascii Number g_premium1[9]/decimals=2 ;

        Global String G_CRIME_FORM[1],
                      G_CODE[7] ;

        local signed ascii number l_package_mod[4]=0/dec=2,
                                  l_package[4]=0/dec=2,
                                  l_premium[9]=0,
                                  l_irpm[4]=0/dec=2,
                                  l_deviation[4]=0/dec=2 ;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    L_LINE_OF_BUSINESS[4];

        Local String L_SCREEN[11] ,
                     L_CODE[7] ,
                     L_CODE_1[7],
                     L_CRIME_FORM[1],
                     L_CODE_2[7],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_ADD_ENDORSEMENT[1],
                     L_DELETE_ENDORSEMENT[1],
                     L_COMPANY_ID[10] ;

        Local Date L_EFF_DATE[8] ;

        Access cppCRIME1, Set cppCRIME1:policy_NO = G_policy_NO,
                              cppcrime1:pol_year = g_year,
                              cppcrime1:end_sequence = g_end_sequence, generic

        Include "STDKEYS7.INC"
        !F8="Append"/function ;
        !F7="Chg"/function/icon="Change" ;

style definition

        include "styles.inc"

Functions

        "add" sequence "new" tagged add_fn ;
        "new" add/autoupdate ;
        append tagged append_fn ;

        "Chg" sequence "amend|popup" tagged change_fn ;
        "Change" sequence "Amend|popup" tagged change_fn ;
        "amend"  change/hidden ;
        "view" sequence "popup" tagged view_fn ;

        "redisplay" Display/noreturn "cppmtmso005" ;
        "popup" Continue Begin
                         Do SETSCREEN
                         G_CODE = cppCRIME1:CODE
                         g_prem_no = cppcrime1:prem_no
                         g_build_no = cppcrime1:build_no
                         G_CRIME_FORM = L_CRIME_FORM
                         G_SUB_CODE = cppCRIME1:SUB_CODE
                         If L_SCREEN <> "" Then
                             FUNCTION = "disscn"
                         End ;
        "disscn" Display L_SCREEN ;

        "func1" sequence "aform" tagged employee_fn ;
        "aform" continue  Begin
                    g_crime_form = "A"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso500"
                    function = "displayscreen"
                    end ;

        "func2" sequence "bform" tagged forgery_fn ;
        "bform" continue  Begin
                    g_crime_form = "B"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso500"
                    function = "displayscreen"
                    end ;

        "func3" sequence "cform" tagged money_fn ;
        "cform" continue  Begin
                    g_crime_form = "C"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso501"
                    function = "displayscreen"
                    end ;

        "func4" sequence "dform" tagged robbery_fn ;
        "dform" continue  Begin
                    g_crime_form = "D"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso502"
                    function = "displayscreen"
                    end ;

        "func5" sequence "eform" tagged prem_burglary_fn ;
        "eform" continue  Begin
                    g_crime_form = "E"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso503"
                    function = "displayscreen"
                    end ;

        "func7" sequence "lform" tagged guests_fn ;
        "lform" continue  Begin
                    g_crime_form = "L"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso505"
                    function = "displayscreen"
                    end ;

        "func9" sequence "wform" tagged worship_fn ;
        "wform" continue  Begin
                    g_crime_form = "W"
                    g_prem_no = cppcrime1:prem_no
                    g_build_no = cppcrime1:build_no
                    l_screen = "cppmtmso507"
                    function = "displayscreen"
                    end ;

        "displayscreen"  display l_screen ;

        include "stdfunc7m.inc"

menu definition

        include "stdmenu7.inc"

        Include "cppmsocrmenu7.inc"

}

toolbar definition

        include "stdtoolbar7m.inc"
}

        include "stdblanktoolbar7.inc"

}

        include "cppmsoendtoolbar7.inc"

}

Screen Entry
If cppCRIME1:policy_NO = G_policy_NO and
   cppcrime1:pol_year = g_year and
   cppcrime1:end_sequence = g_end_sequence then
 Begin
   If cppcrime1:prem_no <> 0 then
     Begin
       g_prem_no = cppcrime1:prem_no
     End
   If cppcrime1:build_no <> 0 then
     Begin
       g_build_no = cppcrime1:build_no
     End
 End

Access Validation
If cppCRIME1:policy_NO <> G_policy_NO or
   cppcrime1:pol_year <> g_year or
   cppcrime1:end_sequence <> g_end_sequence Then
    Error 1000


screen
Properties
        {
        Layouttype = column
        }
{
Panel
Properties
        {
        Borderstyle     = raised
        Scrollbarpolicy = asneeded
        }
{
%%
                                                        _______________
*------------------------------------------------------------------------------*
| Policy No: _________  ____  ____                                             |
| Loc No:    ____                                                              |
| Build No:  ____                                                              |
*------------------------------------------------------------------------------*
| State:     __  _______________  County: ___  _______________________________ |
| Company Deviation:      ______  Package Mod: ______                          |
| IRPM:                   ______                                               |
*------------------------------------------------------------------------------*
|         Form/Edition                   Description                 Premium   |
*------------------------------------------------------------------------------*
| ____________________________ _________________________________ _____________ |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
|                                                                              |
*------------------------------------------------------------------------------*
%%

components

Fields
101     FUNCTION/noecho/showasguidetext ;
301     Begin
        If FUNCTION = "ADD" Or
           FUNCTION = "APPEND" Or
           FUNCTION = "NEW" or
           function = "ADDNEW" Then
            Begin
            cppCRIME1:policy_NO = G_policy_NO
            cppcrime1:pol_year = g_year
            cppcrime1:end_sequence = g_end_sequence
/*            cppCRIME1:PREM_NO = G_PREM_NO
            If G_PREM_NO = 0 Then
                cppCRIME1:PREM_NO = 1
            cppCRIME1:BUILD_NO = G_BUILD_NO
            If G_BUILD_NO = 0 Then
                cppCRIME1:BUILD_NO = 1*/
            cppcrime1:rating_line_of_business = sfsline:rating_line_of_business
            End
        If FUNCTION one of  "Change", "Chg", "amend" then
          Begin
            If G_PREM_NO <> CPPCRIME1:PREM_NO THEN
              BEGIN
                G_PREM_NO = CPPCRIME1:PREM_NO
              END
            If G_BUILD_NO <> CPPCRIME1:BUILD_NO then
              BEGIN
                G_BUILD_NO = CPPCRIME1:BUILD_NO
              END
          End
        End
        cppCRIME1:policy_NO/displayonly ;
302     cppcrime1:pol_year/displayonly ;
303     cppcrime1:end_sequence/displayonly ;
401     cppCRIME1:PREM_NO/default ;
501     cppCRIME1:BUILD_NO/default ;
701     Begin
        If FUNCTION One Of "ADD", "NEW", "APPEND", "ADDNEW" Then
            Begin
            If cppGENERAL:STATE <> 0 Then
                Begin
                cppcrime1:STATE = cppGENERAL:STATE
                cppcrime1:COUNTY = cppGENERAL:COUNTY
                End
            Else
            If cppLIABILITY:STATE <> 0 Then
                Begin
                cppcrime1:STATE = cppLIABILITY:STATE
                cppcrime1:COUNTY = cppLIABILITY:COUNTY
                End
            Else
                Begin
                cppcrime1:STATE = CPSDEFAULT:STATE
                cppcrime1:COUNTY = CPSDEFAULT:COUNTY
                End
            End
        End
        cppCRIME1:STATE/default
        Include "statehlp.inc"
702     SFSSTATE:DESCRIPTION;
703     cppCRIME1:COUNTY/default
        Include "countyhlp.inc"
704     SFSSTATE_ALIAS:DESCRIPTION;
801     Begin
        If FUNCTION one of "ADD", "NEW", "APPEND", "ADDNEW" then
            begin
--            Do COMPANY_DEVIATION
            cppcrime1:company_deviation = 1.00
            end
        End
        cppCRIME1:COMPANY_DEVIATION/default ;
802     Begin
        If FUNCTION one of "ADD", "NEW", "APPEND", "ADDNEW" then
            Do PACKAGE_MOD
        End
        cppCRIME1:PACKAGE_MOD/default ;
901     Begin
        If FUNCTION one of "ADD", "NEW", "APPEND", "ADDNEW" then
            begin
            access sfscompany, set sfscompany:company_id = sfpname:company_id, generic

            if sfscompany:boiler_Rating = 4 Then
                Do IRPM
            else
                cppcrime1:irpm = 1.00
            end
        End
        cppCRIME1:irpm/default ;

1301    Begin
        If FUNCTION = "APPEND" Or
           FUNCTION = "ADD" Or
           FUNCTION = "NEW" or
           function = "ADDNEW" Then
            Begin
            Do SUBCODE
            Access cppCRIME1_alias, Set cppCRIME1_alias:policy_NO = cppcrime1:policy_NO,
                                        cppcrime1_alias:pol_year = cppcrime1:pol_year,
                                        cppcrime1_alias:end_sequence = cppcrime1:end_sequence,
                                        cppCRIME1_alias:PREM_NO = cppcrime1:PREM_NO,
                                        cppCRIME1_alias:BUILD_NO = cppcrime1:BUILD_NO, generic

            if cppcrime1:state = 0 then
                cppcrime1:state = cppcrime1_alias:state
            if cppcrime1:county = 0 then
                cppcrime1:county = cppcrime1_alias:county
            if cppcrime1:company_deviation = 0 then
                cppcrime1:company_deviation = cppcrime1_alias:company_deviation
            if cppcrime1:package_mod = 0 then
                cppcrime1:package_mod = cppcrime1_alias:package_mod
            if cppcrime1:irpm = 0 then
                cppcrime1:irpm = cppcrime1_alias:irpm

            g_state = cppcrime1:state
            g_county = cppcrime1:county
            cppCRIME1:SUB_CODE = L_SUB_CODE + 10
            cppcrime1:premium = 0
            cppcrime1:total_premium = 0
            End
        L_EFF_DATE = sfpNAME:EFF_DATE
        L_COMPANY_ID = sfpNAME:COMPANY_ID
        L_STATE = cppcrime1:STATE
        l_line_of_business = sfsline:rating_line_of_business

        Access SFSOPTEND_ALIAS, Set SFSOPTEND_ALIAS:COMPANY_ID = L_COMPANY_ID,
                                    SFSOPTEND_ALIAS:STATE = L_STATE,
                                    SFSOPTEND_ALIAS:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS, Generic

        End
        cppCRIME1:CODE/uppercase tagged line_items
        Do ACCESS_KEY
        If cppCRIME1:CODE <> SFSOPTEND:CODE Then
            Error 1264

        Activehelp If ((L_EFF_DATE >= SFSOPTEND_ALIAS:EFF_DATE And
                      SFSOPTEND_ALIAS:EXP_DATE >= L_EFF_DATE) Or
                      (L_EFF_DATE >= SFSOPTEND_ALIAS:EFF_DATE And
                      SFSOPTEND_ALIAS:EXP_DATE = 0) And
                      SFSOPTEND_ALIAS:END_LOB_CODE = "C") Then
                       SFSOPTEND_ALIAS:CODE
                   Else
                       NULL/width=8 ,
                   If ((L_EFF_DATE >= SFSOPTEND_ALIAS:EFF_DATE And
                      SFSOPTEND_ALIAS:EXP_DATE >= L_EFF_DATE) Or
                      (L_EFF_DATE >= SFSOPTEND_ALIAS:EFF_DATE And
                      SFSOPTEND_ALIAS:EXP_DATE = 0) And
                      SFSOPTEND_ALIAS:END_LOB_CODE = "C") Then
                       SFSOPTEND_ALIAS:FORM_EDITION
                   Else
                       NULL/width=25 ,
                   If ((L_EFF_DATE >= SFSOPTEND_ALIAS:EFF_DATE And
                      SFSOPTEND_ALIAS:EXP_DATE >= L_EFF_DATE) Or
                      (L_EFF_DATE >= SFSOPTEND_ALIAS:EFF_DATE And
                      SFSOPTEND_ALIAS:EXP_DATE = 0) And
                      SFSOPTEND_ALIAS:END_LOB_CODE = "C") Then
                       SFSOPTEND_ALIAS:DESCRIPTION
                   Else
                       NULL/width=75 ;
1301    Begin
        If FUNCTION = "ADD" Or
           FUNCTION = "APPEND" Or
           FUNCTION = "NEW" or
           function = "ADDNEW" Then
            Do ACCESS_ENDORSEMENT
        If cppCRIME1:CODE = "" Then
            Abort()
        End
        cppCRIME1:FORM_EDITION/displayonly tagged line_items;
1302    cppCRIME1:DESCRIPTION/displayonly tagged line_items;
1303    Begin
        If L_SCREEN <> "" Then
            Begin
            If FUNCTION = "ADD" Or
               FUNCTION = "APPEND" Or
               FUNCTION = "NEW" or
               function = "ADDNEW" Then
                Begin
                g_premium1 = 0
                G_CRIME_FORM = L_CRIME_FORM
                G_CODE = cppCRIME1:CODE
                G_SUB_CODE = cppCRIME1:SUB_CODE
                g_prem_no = cppcrime1:prem_no
                g_build_no = cppcrime1:build_no
                Display Modal Screen L_SCREEN
                cppCRIME1:total_PREMIUM = g_premium1
                End
            End

        If FUNCTION One Of "ADD", "APPEND", "NEW", "CHANGE", "ADDNEW", "AMEND" Then
            Begin
            access cpsdefault, set cpsdefault:company_id = sfpname:company_id,
                                   cpsdefault:line_of_business = l_line_of_business, generic

            If CPSDEFAULT:DEVIATION_NUMBER_NOT_FACTOR = 1 And
               cppcrime1:COMPANY_DEVIATION <> 1.00 Then
                L_DEVIATION = (1 + (cppcrime1:COMPANY_DEVIATION * 0.01))
            Else
                L_DEVIATION = cppcrime1:COMPANY_DEVIATION

            If CPSDEFAULT:DEVIATION_NUMBER_NOT_FACTOR = 1 And
               cppcrime1:PACKAGE_MOD <> 1.00 Then
                L_PACKAGE = (1 + (cppcrime1:PACKAGE_MOD * 0.01))
            Else
                L_PACKAGE = cppcrime1:PACKAGE_MOD

            If CPSDEFAULT:DEVIATION_NUMBER_NOT_FACTOR = 1 And
               cppcrime1:IRPM <> 1.00 Then
                l_irpm = (1 + (cppcrime1:irpm * 0.01))
            Else
                l_irpm = cppcrime1:irpm

            if l_irpm = 0 then
                l_irpm = 1.00

            access cppcrime, set cppcrime:policy_no    = cppcrime1:policy_no,
                                 cppcrime:pol_year     = cppcrime1:pol_year,
                                 cppcrime:end_sequence = cppcrime1:end_sequence,
                                 cppcrime:prem_no      = cppcrime1:prem_no,
                                 cppcrime:build_no     = cppcrime1:build_no, generic

            while cppcrime:policy_no    = cppcrime1:policy_no and
                  cppcrime:pol_year     = cppcrime1:pol_year and
                  cppcrime:end_sequence = cppcrime1:end_sequence and
                  cppcrime:prem_no      = cppcrime1:prem_no and
                  cppcrime:build_no     = cppcrime1:build_no
                begin
                if cppcrime:crime_form = "A" and
                   cppcrime1:code = "MCP171" then
                    cppcrime1:total_premium = cppcrime:crime_premium

                if cppcrime:crime_form = "B" and
                   cppcrime1:code = "MCP172" then
                    cppcrime1:total_premium = cppcrime:crime_premium

                if cppcrime:crime_form = "C" and
                   cppcrime1:code = "MCP173" then
                    cppcrime1:total_premium = cppcrime:crime_premium

                if cppcrime:crime_form = "D" and
                   cppcrime1:code = "MCP175" then
                    cppcrime1:total_premium = cppcrime:crime_premium

                if cppcrime:crime_form = "E" and
                   cppcrime1:code = "MCP177" then
                    cppcrime1:total_premium = cppcrime:crime_premium

                if cppcrime:crime_form = "L" and
                   cppcrime1:code = "MCP181" then
                    cppcrime1:total_premium = cppcrime:crime_premium

                next cppcrime
                end

            L_PREMIUM = cppcrime1:total_premium * L_DEVIATION * L_PACKAGE * l_irpm
            cppcrime1:PREMIUM = L_PREMIUM
            End

        End
        cppCRIME1:PREMIUM/displayonly tagged line_items ;

}

}


Postupdate
Begin
If Abort = "NO" And
   UPDATEOK = "YES" Then
    Begin
    If FUNCTION One Of "ADD", "NEW", "APPEND", "CHANGE", "ADDNEW" Then
        Begin
        Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                             cppcrime:pol_year = cppcrime1:pol_year,
                             cppcrime:end_sequence = cppcrime1:end_sequence,
                             cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                             cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO, Generic

        L_STATE = cppCRIME:STATE
        Access CPSCRTRIGGER, Set CPSCRTRIGGER:COMPANY_ID = sfpNAME:COMPANY_ID,
                                 CPSCRTRIGGER:STATE = L_STATE,
                                 CPSCRTRIGGER:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS, Generic

        While CPSCRTRIGGER:COMPANY_ID = sfpNAME:COMPANY_ID And
              CPSCRTRIGGER:STATE = L_STATE And
              CPSCRTRIGGER:LINE_OF_BUSINESS =  L_LINE_OF_BUSINESS
                Begin
                L_CODE_1 = CPSCRTRIGGER:TRIGGER_ENDORSEMENT[1]
                L_CODE_2 = CPSCRTRIGGER:TRIGGER_ENDORSEMENT[2]

                Next CPSCRTRIGGER
                End

        If L_CODE_1 <> "" Then
            Begin
            L_CODE = L_CODE_1
            Do ACCESS_cppCRIME1
            If L_ADD_ENDORSEMENT = "Y" Then
                Do ADD_cppCRIME1
            End

        If L_CODE_2 <> "" and
           cppcrime1:code <> "MCP771" Then
            Begin
            L_CODE = L_CODE_2
            Do ACCESS_cppCRIME1
            If L_ADD_ENDORSEMENT = "Y" Then
                Do ADD_cppCRIME1
            End

        End

    If FUNCTION = "DELETE" Then
        Begin
        Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                             cppcrime:pol_year = cppcrime1:pol_year,
                             cppcrime:end_sequence = cppcrime1:end_sequence,
                             cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                             cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO, Generic

        L_STATE = cppCRIME:STATE
        Access CPSCRTRIGGER, Set CPSCRTRIGGER:COMPANY_ID = sfpNAME:COMPANY_ID,
                                 CPSCRTRIGGER:STATE = L_STATE,
                                 CPSCRTRIGGER:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS, Generic

        While CPSCRTRIGGER:COMPANY_ID = sfpNAME:COMPANY_ID And
              CPSCRTRIGGER:STATE = L_STATE And
              CPSCRTRIGGER:LINE_OF_BUSINESS =  L_LINE_OF_BUSINESS
                Begin
                L_CODE_1 = CPSCRTRIGGER:TRIGGER_ENDORSEMENT[1]
                L_CODE_2 = CPSCRTRIGGER:TRIGGER_ENDORSEMENT[2]

                Next CPSCRTRIGGER
                End

        If L_CODE_1 <> "" Then
            Begin
            L_CODE = L_CODE_1
            Do ACCESS_cppCRIME1_DELETE
            If L_DELETE_ENDORSEMENT = "Y" Then
                Do DELETE_cppCRIME1
            End

        If L_CODE_2 <> "" Then
            Begin
            L_CODE = L_CODE_2
            Do ACCESS_cppCRIME1_DELETE
            If L_DELETE_ENDORSEMENT = "Y" Then
                Do DELETE_cppCRIME1
            End

        End

    End


If FUNCTION = "DELETE" And
   Abort = "NO" And
   UPDATEOK = "YES" Then
    Begin
    Switch(cppCRIME1:CODE)
      Case "MCP171",
           "MCP771" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "A", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "A"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP172" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "B", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "B"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP173" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "C", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "C"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP175" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "D", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "D"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP177" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "E", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "E"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP179" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "H", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "H"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP181" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "L", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "L"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP183" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "Q", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "Q"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End
      Case "MCP185" : Begin
                      Access cppCRIME, Set cppCRIME:policy_NO = cppCRIME1:policy_NO,
                                           cppcrime:pol_year = cppcrime1:pol_year,
                                           cppcrime:end_sequence = cppcrime1:end_sequence,
                                           cppCRIME:PREM_NO = cppCRIME1:PREM_NO,
                                           cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO,
                                           cppCRIME:CRIME_FORM = "W", Generic

                      While cppCRIME:policy_NO = cppCRIME1:policy_NO And
                            cppcrime:pol_year = cppcrime1:pol_year and
                            cppcrime:end_sequence = cppcrime1:end_sequence and
                            cppCRIME:PREM_NO = cppCRIME1:PREM_NO And
                            cppCRIME:BUILD_NO = cppCRIME1:BUILD_NO And
                            cppCRIME:CRIME_FORM = "W"
                                Begin
                                Delete cppCRIME

                                Next cppCRIME
                                End
                      End

      End

    End

If Abort = "YES" Or
   FUNCTION = "DELETE" Then
    FUNCTION = "redisplay"
End

Procedure Definition

Procedure COMPANY_DEVIATION
Begin
Access cppGENERAL, Set cppGENERAL:policy_NO = G_policy_NO,
                       cppgeneral:pol_year = g_year,
                       cppgeneral:end_sequence = g_end_sequence,
                       cppGENERAL:PREM_NO = G_PREM_NO,
                       cppGENERAL:BUILD_NO = G_BUILD_NO, Generic

Access cppLIABILITY, Set cppLIABILITY:policy_NO = G_policy_NO,
                         cppliability:pol_year = g_year,
                         cppliability:end_sequence = g_end_sequence,
                         cppLIABILITY:PREM_NO = G_PREM_NO,
                         cppLIABILITY:BUILD_NO = G_BUILD_NO, Generic

If cppGENERAL:policy_NO = G_policy_NO And
   cppgeneral:pol_year = g_year and
   cppgeneral:end_Sequence = g_End_sequence and
   cppGENERAL:PREM_NO = G_PREM_NO And
   cppGENERAL:BUILD_NO = G_BUILD_NO Then
    cppcrime1:COMPANY_DEVIATION = cppGENERAL:COMPANY_DEVIATION[1]
Else
    If cppLIABILITY:policy_NO = G_policy_NO And
       cppliability:pol_year = g_year and
       cppliability:end_Sequence = g_End_sequence and
       cppLIABILITY:PREM_NO = G_PREM_NO And
       cppLIABILITY:BUILD_NO = G_BUILD_NO Then
        cppcrime1:COMPANY_DEVIATION = cppLIABILITY:COMPANY_DEVIATION[1]
Else
    If cppcrime1:COMPANY_DEVIATION = 0 Then
        cppcrime1:COMPANY_DEVIATION = 1.00

End

Procedure PACKAGE_MOD
Begin
Access cppGENERAL, Set cppGENERAL:policy_NO = G_policy_NO,
                       cppgeneral:pol_year = g_year,
                       cppgeneral:end_sequence = g_end_sequence,
                       cppGENERAL:PREM_NO = G_PREM_NO,
                       cppGENERAL:BUILD_NO = G_BUILD_NO, Generic

Access cppLIABILITY, Set cppLIABILITY:policy_NO = G_policy_NO,
                         cppliability:pol_year = g_year,
                         cppliability:end_sequence = g_end_sequence,
                         cppLIABILITY:PREM_NO = G_PREM_NO,
                         cppLIABILITY:BUILD_NO = G_BUILD_NO, Generic

If cppGENERAL:policy_NO = G_policy_NO And
   cppgeneral:pol_year = g_year and
   cppgeneral:end_Sequence = g_End_sequence and
   cppGENERAL:PREM_NO = G_PREM_NO And
   cppGENERAL:BUILD_NO = G_BUILD_NO Then
    cppcrime1:PACKAGE_MOD = cppGENERAL:PACKAGE_MOD[1]
Else
    If cppLIABILITY:policy_NO = G_policy_NO And
       cppliability:pol_year = g_year and
       cppliability:end_Sequence = g_End_sequence and
       cppLIABILITY:PREM_NO = G_PREM_NO And
       cppLIABILITY:BUILD_NO = G_BUILD_NO Then
        cppcrime1:PACKAGE_MOD = cppLIABILITY:PACKAGE_MOD[1]
Else
    Begin
    L_COMPANY_ID = sfpNAME:COMPANY_ID
    L_STATE = cppcrime1:state
    L_EFF_DATE = sfpNAME:EFF_DATE

    Include "sfspackage.pro"

    If L_PACKAGE_MOD <> 0 And
       sfpNAME:PACKAGE = 1 Then
        Begin
        cppcrime1:PACKAGE_MOD = L_PACKAGE_MOD
        End
    Else
        Begin
        cppcrime1:PACKAGE_MOD = 1.00
        End

    End

End

Procedure IRPM
Begin
Access cppGENERAL, Set cppGENERAL:policy_NO = G_policy_NO,
                       cppgeneral:pol_year = g_year,
                       cppgeneral:end_sequence = g_end_sequence,
                       cppGENERAL:PREM_NO = G_PREM_NO,
                       cppGENERAL:BUILD_NO = G_BUILD_NO, Generic

Access cppLIABILITY, Set cppLIABILITY:policy_NO = G_policy_NO,
                         cppliability:pol_year = g_year,
                         cppliability:end_sequence = g_end_sequence,
                         cppLIABILITY:PREM_NO = G_PREM_NO,
                         cppLIABILITY:BUILD_NO = G_BUILD_NO, Generic

If cppGENERAL:policy_NO = G_policy_NO And
   cppgeneral:pol_year = g_year and
   cppgeneral:end_Sequence = g_End_sequence and
   cppGENERAL:PREM_NO = G_PREM_NO And
   cppGENERAL:BUILD_NO = G_BUILD_NO Then
    cppcrime1:irpm = cppgeneral:company_deviation[2]
else
    cppcrime1:PACKAGE_MOD = 1.00

End

Procedure ACCESS_cppCRIME1_DELETE
Begin
Access cppCRIME1_ALIAS, Set cppCRIME1_ALIAS:policy_NO = G_policy_NO ,
                            cppcrime1_alias:pol_year = g_year,
                            cppcrime1_alias:end_sequence = g_end_sequence,
                            cppCRIME1_ALIAS:PREM_NO = G_PREM_NO,
                            cppCRIME1_ALIAS:BUILD_NO = G_BUILD_NO, Generic

L_DELETE_ENDORSEMENT = "Y"
Repeat Begin
    Exit If cppCRIME1_ALIAS:policy_NO <> G_policy_NO Or
            cppcrime1_alias:pol_year <> g_year or
            cppcrime1_alias:end_Sequence <> g_End_sequence or
            cppCRIME1_ALIAS:PREM_NO <> G_PREM_NO Or
            cppCRIME1_ALIAS:BUILD_NO <> G_BUILD_NO

    If cppCRIME1_ALIAS:CODE <> L_CODE_1 And
       cppCRIME1_ALIAS:CODE <> L_CODE_2 Then
        L_DELETE_ENDORSEMENT = "N"

    Next cppCRIME1_ALIAS
    End

End

Procedure ACCESS_cppCRIME1
Begin
Access cppCRIME1_ALIAS, Set cppCRIME1_ALIAS:policy_NO = G_policy_NO ,
                            cppcrime1_alias:pol_year = g_year,
                            cppcrime1_alias:end_sequence = g_end_sequence,
                            cppCRIME1_ALIAS:PREM_NO = G_PREM_NO,
                            cppCRIME1_ALIAS:BUILD_NO = G_BUILD_NO, Generic

L_ADD_ENDORSEMENT = "Y"
Repeat Begin
    Exit If cppCRIME1_ALIAS:policy_NO <> G_policy_NO Or
            cppcrime1_alias:pol_year <> g_year or
            cppcrime1_alias:end_Sequence <> g_End_sequence or
            cppCRIME1_ALIAS:PREM_NO <> G_PREM_NO Or
            cppCRIME1_ALIAS:BUILD_NO <> G_BUILD_NO

    If cppCRIME1_ALIAS:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next cppCRIME1_ALIAS
    End

End

Procedure ADD_cppCRIME1
Begin
Access cppCRIME1_ALIAS, Set cppCRIME1_ALIAS:policy_NO = G_policy_NO ,
                            cppcrime1_alias:pol_year = g_year,
                            cppcrime1_alias:end_sequence = g_end_sequence,
                            cppCRIME1_ALIAS:PREM_NO = G_PREM_NO,
                            cppCRIME1_ALIAS:BUILD_NO = G_BUILD_NO, Generic

L_SUB_CODE = 0
Repeat Begin
    Exit If cppCRIME1_ALIAS:policy_NO <> G_policy_NO Or
            cppcrime1_alias:pol_year <> g_year or
            cppcrime1_alias:end_Sequence <> g_End_sequence or
            cppCRIME1_ALIAS:PREM_NO <> G_PREM_NO Or
            cppCRIME1_ALIAS:BUILD_NO <> G_BUILD_NO

    L_SUB_CODE = cppCRIME1_ALIAS:SUB_CODE

    Next cppCRIME1_ALIAS
    End

L_SUB_CODE = L_SUB_CODE + 10

L_STATE = cppCRIME1:STATE
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = sfpNAME:COMPANY_ID,
                      SFSOPTEND:STATE = L_STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                      SFSOPTEND:CODE = L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> sfpNAME:COMPANY_ID Or
            SFSOPTEND:STATE <> L_STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> L_LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If sfpNAME:EFF_DATE >= SFSOPTEND:EFF_DATE Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

Add cppCRIME1_ALIAS
    Begin
    cppCRIME1_ALIAS:policy_NO            =       G_policy_NO
    cppcrime1_alias:pol_Year             =       g_year
    cppcrime1_alias:end_sequence         =       g_end_Sequence
    cppCRIME1_ALIAS:PREM_NO              =       G_PREM_NO
    cppCRIME1_ALIAS:BUILD_NO             =       G_BUILD_NO
    cppCRIME1_ALIAS:SUB_CODE             =       L_SUB_CODE
    cppCRIME1_ALIAS:CODE                 =       L_CODE
    cppCRIME1_ALIAS:FORM_EDITION         =       L_FORM_EDITION
    cppCRIME1_ALIAS:DESCRIPTION          =       L_DESCRIPTION
    cppCRIME1_ALIAS:PREMIUM              =       0
    End

End

Procedure DELETE_cppCRIME1
Begin
Access cppCRIME1_ALIAS, Set cppCRIME1_ALIAS:policy_NO = G_policy_NO ,
                            cppcrime1_alias:pol_year = g_year,
                            cppcrime1_alias:end_sequence = g_end_sequence,
                            cppCRIME1_ALIAS:PREM_NO = G_PREM_NO,
                            cppCRIME1_ALIAS:BUILD_NO = G_BUILD_NO, Generic

Repeat Begin
    Exit If cppCRIME1_ALIAS:policy_NO <> G_policy_NO Or
            cppcrime1_alias:pol_year <> g_year or
            cppcrime1_alias:end_sequence <> g_end_sequence or
            cppCRIME1_ALIAS:PREM_NO <> G_PREM_NO Or
            cppCRIME1_ALIAS:BUILD_NO <> G_BUILD_NO

    If cppCRIME1_ALIAS:CODE = L_CODE Then
        Delete cppCRIME1_ALIAS

    Next cppCRIME1_ALIAS
    End

End

Procedure SUBCODE
Begin
Access cppCRIME1_ALIAS, Set cppCRIME1_ALIAS:policy_NO = cppCRIME1:policy_NO,
                            cppcrime1_alias:pol_year = g_year,
                            cppcrime1_alias:end_sequence = g_end_sequence,
                            cppCRIME1_ALIAS:PREM_NO = cppCRIME1:PREM_NO,
                            cppCRIME1_ALIAS:BUILD_NO = cppCRIME1:BUILD_NO,Approximate

L_SUB_CODE = 0
Repeat Begin
    Exit If cppCRIME1_ALIAS:policy_NO <> cppCRIME1:policy_NO Or
            cppcrime1_alias:pol_year <> g_year or
            cppcrime1_alias:end_sequence <> g_end_sequence or
            cppCRIME1_ALIAS:PREM_NO <> cppCRIME1:PREM_NO Or
            cppCRIME1_ALIAS:BUILD_NO <> cppCRIME1:BUILD_NO

    L_SUB_CODE = cppCRIME1_ALIAS:SUB_CODE

    Next cppCRIME1_ALIAS
    End

G_SUB_CODE = cppCRIME1:SUB_CODE

End

Procedure ACCESS_ENDORSEMENT
Begin
L_STATE = cppcrime1:STATE
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = sfpNAME:COMPANY_ID,
                      SFSOPTEND:STATE = L_STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                      SFSOPTEND:CODE = cppCRIME1:CODE, Generic

L_SCREEN = ""
Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> sfpNAME:COMPANY_ID Or
            SFSOPTEND:STATE <> L_STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> L_LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> cppCRIME1:CODE

    If sfpNAME:EFF_DATE >= SFSOPTEND:EFF_DATE Then
        Begin
        L_CODE = cppCRIME1:CODE
        G_CODE = cppCRIME1:CODE
        cppCRIME1:FORM_EDITION = SFSOPTEND:FORM_EDITION
        cppCRIME1:DESCRIPTION = SFSOPTEND:DESCRIPTION
        L_SCREEN = SFSOPTEND:policy_SCREEN
        L_CRIME_FORM = SFSOPTEND:CRIME_FORM
        End

    Next SFSOPTEND
    End

End

Procedure SETSCREEN
Begin
L_STATE = cppcrime1:STATE
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = sfpNAME:COMPANY_ID,
                      SFSOPTEND:STATE = L_STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                      SFSOPTEND:CODE = cppCRIME1:CODE, Generic

L_SCREEN = ""
Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> sfpNAME:COMPANY_ID Or
            SFSOPTEND:STATE <> L_STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> L_LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> cppCRIME1:CODE

    If sfpNAME:EFF_DATE >= SFSOPTEND:EFF_DATE Then
        Begin
        L_SCREEN = SFSOPTEND:policy_SCREEN
        L_CRIME_FORM = SFSOPTEND:CRIME_FORM
        End

    Next SFSOPTEND
    End

End

Procedure ACCESS_KEY
Begin
L_STATE = cppcrime1:STATE
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = sfpNAME:COMPANY_ID ,
                      SFSOPTEND:STATE = L_STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                      SFSOPTEND:CODE = cppCRIME1:CODE, Generic

End

End
